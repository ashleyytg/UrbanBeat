<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrbanBeat - Ve al ritmo de la ciudad</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuraci√≥n de Tailwind para colores personalizados y fuente Inter
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'], // Fuente principal
                    },
                    colors: {
                        // Paleta de colores inspirada en la naturaleza para UrbanBeat
                        emerald: {
                            50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399',
                            500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b',
                        },
                        amber: {
                            50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24',
                            500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f',
                        },
                    }
                }
            }
        }
    </script>
    <!-- Incluimos la librer√≠a de mapas Leaflet (CSS y JavaScript) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <style>
        /* Estilos base para asegurar que la p√°gina ocupe toda la altura y use la fuente definida */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif; /* Usamos la fuente Inter de Tailwind config */
            background-color: #f4f4f5; /* Fondo gris claro */
            display: flex;
            flex-direction: column; /* Para que el footer se pegue abajo */
        }
        /* Estilo para el contenedor del mapa para asegurar que tenga una altura m√≠nima */
        #map {
            height: 500px; /* Altura por defecto para el mapa */
            width: 100%;
            border-radius: 0.5rem; /* Bordes redondeados para el mapa */
        }
        /* Ajuste de altura del mapa para pantallas m√°s peque√±as */
        @media (max-width: 768px) {
            #map {
                height: 300px; /* Altura m√°s corta en m√≥viles */
            }
        }
        /* Estilo para el mensaje de informaci√≥n del mapa */
        #info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9); /* Fondo blanco semitransparente */
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none; /* Oculto por defecto, se muestra con JS */
            font-size: 0.9em;
            color: #333;
        }
        /* Estilo para el mensaje de error */
        #error-message {
            color: #ef4444; /* Rojo de Tailwind */
            margin-top: 15px;
            font-weight: 500;
            display: none; /* Oculto por defecto */
            text-align: center;
            padding: 10px;
            background-color: #fee2e2; /* Fondo rojo claro */
            border-radius: 8px;
            border: 1px solid #fca5a5;
        }
        /* Estilos para el efecto de pasar el rat√≥n por encima del encabezado */
        .header-bg-image {
            background-image: url('https://www.peru.travel/Contenido/Atractivo/Imagen/es/14/1.1/Principal/centro-historico-de-lima.jpg'); /* Imagen de fondo para el encabezado */
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden; /* Para asegurar que el pseudo-elemento no se desborde */
        }
        .header-bg-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4); /* Capa oscura para que el texto resalte */
            z-index: 1;
        }
        .header-content {
            position: relative;
            z-index: 2; /* Asegura que el contenido est√© por encima de la capa oscura */
        }
    </style>
</head>

<body class="font-sans text-gray-800">

    <!-- Secci√≥n del Encabezado (Header) -->
    <header class="bg-emerald-700 text-white p-4 shadow-md">
        <nav class="container mx-auto flex justify-between items-center">
            <!-- T√≠tulo del sitio/logo -->
            <a href="#" class="text-3xl font-bold tracking-tight text-emerald-50 hover:text-emerald-200 transition duration-300">UrbanBeat</a>
            <!-- Men√∫ de navegaci√≥n -->
            <ul class="flex space-x-6">
                <li><a href="#" class="hover:text-emerald-200 transition duration-300 transform hover:scale-110">Inicio</a></li>
                <li><a href="#" class="hover:text-emerald-200 transition duration-300 transform hover:scale-110">Explorar</a></li>
                <li><a href="#" class="hover:text-emerald-200 transition duration-300 transform hover:scale-110">Acerca de</a></li>
                <li><a href="#" class="hover:text-emerald-200 transition duration-300 transform hover:scale-110">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <!-- Nuevo Encabezado con Imagen de Fondo y T√≠tulo Central -->
    <section class="header-bg-image py-20 px-4 text-center text-white">
        <div class="header-content container mx-auto">
            <h1 class="text-5xl font-extrabold mb-4 leading-tight">UrbanBeat</h1>
            <p class="text-xl opacity-90">Tu pulso urbano en Lima</p>
        </div>
    </section>

    <!-- Contenido Principal del Visor de Rutas -->
    <main class="container mx-auto py-12 px-4 flex-grow">
        <h2 class="text-4xl font-bold text-center mb-6 text-emerald-800">Visor Autom√°tico de Rutas</h2>
        <p class="text-center text-gray-600 mb-8">
            Carga y visualiza rutas desde un archivo <code class="bg-gray-200 p-1 rounded">ruta.json</code>.
            Aseg√∫rate de que el archivo est√© en la misma carpeta.
        </p>
        
        <div class="flex justify-center mb-8">
            <button onclick="loadAndVisualizeRoute()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Cargar y Visualizar Ruta üó∫Ô∏è
            </button>
        </div>
        
        <div id="error-message" class="max-w-md mx-auto"></div>

        <!-- Contenedor del Mapa -->
        <div id="map-container" class="relative bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden mt-8">
            <div id="map" class="min-h-[300px] md:min-h-[500px]"></div>
            <div id="info"></div>
        </div>
    </main>

    <!-- Secci√≥n del Pie de P√°gina (Footer) -->
    <footer class="bg-gray-800 text-white py-6 px-4 text-center mt-auto">
        <div class="container mx-auto">
            <p>&copy; 2025 UrbanBeat. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Script JavaScript para la l√≥gica del mapa y rutas -->
    <script>
        // Variable global para guardar la instancia del mapa
        let map;

        // Inicializamos el mapa una sola vez al cargar la p√°gina
        function initializeMap() {
            // Verifica si el mapa ya est√° inicializado para evitar duplicados
            if (map) {
                map.remove(); // Elimina la instancia del mapa existente si la hay
            }
            map = L.map('map').setView([-12.0464, -77.0428], 12); // Centrado en Lima
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        }
        
        // Funci√≥n para cargar los datos desde el archivo y luego visualizar
        async function loadAndVisualizeRoute() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.style.display = 'none';

            // Limpiamos el mapa de rutas y marcadores anteriores antes de cargar una nueva
            if (window.routeLayer) {
                map.removeLayer(window.routeLayer);
            }
            const infoDiv = document.getElementById('info');
            infoDiv.style.display = 'none'; // Oculta la informaci√≥n anterior

            try {
                // Usamos fetch para leer el archivo local 'ruta.json'
                const response = await fetch('ruta.json');
                
                if (!response.ok) {
                    throw new Error(`No se pudo encontrar el archivo 'ruta.json' (Error: ${response.status})`);
                }

                const routeData = await response.json();
                visualizeRoute(routeData); // Llamamos a la funci√≥n que dibuja

            } catch (e) {
                errorDiv.textContent = `Error al cargar el archivo: ${e.message}. Aseg√∫rate de que el archivo 'ruta.json' existe y est√° en la misma carpeta.`;
                errorDiv.style.display = 'block';
                console.error("Error al cargar la ruta:", e);
            }
        }

        // Funci√≥n que se encarga √∫nicamente de dibujar los datos en el mapa
        function visualizeRoute(routeData) {
            const infoDiv = document.getElementById('info');

            // --- Procesar y dibujar los nuevos datos ---
            // Asumiendo que routeData.features[0] siempre existe y tiene la estructura esperada
            if (!routeData || !routeData.features || routeData.features.length === 0 || !routeData.features[0].properties || !routeData.features[0].geometry) {
                document.getElementById('error-message').textContent = 'Formato de ruta.json inesperado. Aseg√∫rate de que contiene features[0].properties y features[0].geometry.';
                document.getElementById('error-message').style.display = 'block';
                return;
            }

            const routeProperties = routeData.features[0].properties;
            const routeGeometry = routeData.features[0].geometry;

            // GeoJSON usa [longitud, latitud], pero Leaflet necesita [latitud, longitud]
            // Aseg√∫rate de que routeGeometry.coordinates[0] sea un array de arrays de coordenadas
            if (!routeGeometry.coordinates || routeGeometry.coordinates.length === 0 || !Array.isArray(routeGeometry.coordinates[0])) {
                document.getElementById('error-message').textContent = 'Las coordenadas de la ruta en ruta.json no tienen el formato esperado.';
                document.getElementById('error-message').style.display = 'block';
                return;
            }

            const leafletCoordinates = routeGeometry.coordinates[0].map(coord => [coord[1], coord[0]]);
            
            const routeLine = L.polyline(leafletCoordinates, { color: '#3b82f6', weight: 5, opacity: 0.7 });
            
            const startPoint = leafletCoordinates[0];
            const endPoint = leafletCoordinates[leafletCoordinates.length - 1];

            const startMarker = L.marker(startPoint, {
                icon: L.divIcon({
                    className: 'bg-emerald-600 text-white p-2 rounded-full shadow-md text-xs font-bold',
                    html: 'Inicio',
                    iconSize: [50, 25],
                    iconAnchor: [25, 12]
                })
            }).bindPopup('üìç Inicio de la ruta');
            
            const endMarker = L.marker(endPoint, {
                icon: L.divIcon({
                    className: 'bg-amber-500 text-emerald-900 p-2 rounded-full shadow-md text-xs font-bold',
                    html: 'Fin',
                    iconSize: [40, 25],
                    iconAnchor: [20, 12]
                })
            }).bindPopup('üèÅ Fin de la ruta');

            // A√±ade la capa de ruta y marcadores al mapa
            window.routeLayer = L.layerGroup([routeLine, startMarker, endMarker]).addTo(map);

            // Ajusta la vista del mapa para que la ruta completa sea visible
            map.fitBounds(routeLine.getBounds(), { padding: [50, 50] }); // A√±ade padding para que no est√© pegado al borde

            // Muestra la informaci√≥n de distancia y tiempo
            const distanceKm = (routeProperties.distance / 1000).toFixed(2);
            const timeMin = (routeProperties.time / 60).toFixed(1);
            infoDiv.innerHTML = `<b>Distancia:</b> ${distanceKm} km<br><b>Tiempo:</b> ${timeMin} min`;
            infoDiv.style.display = 'block';
        }

        // Inicializa el mapa cuando el DOM est√© completamente cargado
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>

</body>
</html>
